<html>
<body>

<h2>Ecrire des Rapports (Scripts)</h2>

<p>
Cette page donne les grandes lignes, &agrave; ceux qui veulent se lancer 
dans l'&eacute;criture de rapports (scripts) pour GenJ, &agrave; 
savoir&nbsp;:
</p>

<ol>
<li>Les bases</li>
<li>Les propri&eacute;t&eacute;s et le support international</li>
<li>Les options</li>
<li>Rajouter encore plus de code Java</li>
<li>Obtenir des donn&eacute;es (Part 1): Utilisation des m&eacute;thodes sur les objets</li>
<li>Obtenir des donn&eacute;es (Part 2): Utilisation des &eacute;tiquettes et des propri&eacute;t&eacute;s</li>
</ol>

<h2>Les bases</h2>

<p>
Un rapport GenJ est un Java-type qui &eacute;tend le type 
abstrait <span style="font-style: italic;">genj.report.Report</span>. 
&Eacute;crire votre propre fonction commence par d&eacute;finir votre 
propre classe dans un fichier source qui sera plac&eacute; dans le 
sous-r&eacute;pertoire &laquo;&nbsp;reports&nbsp;&raquo; (son nom 
doit d&eacute;buter avec Report*).
</p>

<p>
Supposons que nous voulions &eacute;crire un rapport test nomm&eacute; 
&laquo;&nbsp;Test&nbsp;&raquo;. D'abord, cr&eacute;ons un fichier 
texte appel&eacute; <span style="font-style: italic;">ReportTest.java</span> 
dans ./reports. Ensuite compilons-le en lan&ccedil;ant le script de 
compilation dans le m&ecirc;me r&eacute;pertoire : rcompile.*(bat, 
sh, cmd). Ce script lance <span style="font-style: italic;">javac</span> 
(le compilateur java). Le r&eacute;sultat final est un fichier 
appel&eacute; <span style="font-style: italic;">ReportTest.class</span> 
que GenJ peut charger et ex&eacute;cuter lorsqu'il sera 
s&eacute;lectionn&eacute; dans 
la&nbsp;<a href="../view/report.html">Visualisation des Rapports</a>.
</p>

<p>
Regardons le fichier exemple <span style="font-style: italic;">ReportTest.java</span>. 
Il contient une d&eacute;finition de classe publique qui est conforme 
&agrave; la finalit&eacute; du Rapport (<span style="font-style: italic;">extension 
de Rapport</span>). Une partie de cette finalit&eacute; est 
d'implanter un <span style="font-style: italic;">public 
void start(Object context)</span> qui est le point d'entr&eacute;e dans 
le Rapport. Nous pouvons utiliser toutes les m&eacute;thodes fournies par 
le paquetage Report - (ici nous utilisons simplement la m&eacute;thode
&laquo;<span style="font-style: italic;">&nbsp;println</span>&nbsp;&raquo;). 
<span style="font-style: italic;">println()</span> envoie du texte dans un 
&eacute;l&eacute;ment graphique (un "widget") que l'utilisateur peut 
voir quand il ex&eacute;cute le rapport.
</p>

<div style="margin-left: 30px;">
import genj.gedcom.*;<br>
import genj.report.*;<br>
import genj.report.Report;<br>
public class ReportTest extends Report {<br>
 <div style="margin-left: 30px;">
  /**<br>
  &nbsp;* the 'main' method<br>
  &nbsp;*/<br>
    public void start(Object context) {<br>
  <div style="margin-left: 50px;">
      println("Salut la terre !");<br>
  </div>
    }<br>
 </div>
 }<br>
</div>

<p>
Maintenant, nous voulons &ecirc;tres s&ucirc;rs que ce rapport 
s'int&egrave;gre parfaitement dans la <a href="../view/report.html">Visualisation 
des Rapports</a> avec son nom, des informations de base, la 
r&eacute;f&eacute;rence &agrave; l'auteur, son num&eacute;ro de 
version. Pour arriver &agrave; cela, nous cr&eacute;ons un fichier 
<span style="font-style: italic;">ReportTest.properties</span> dans 
le m&ecirc;me r&eacute;pertoire et le remplissons avec l'information 
n&eacute;cessaire, ce qui va donner ceci&nbsp;:<br>
<div style="margin-left: 30px;">
# File: ReportTest.properties<br>
# Voici les ressources de texte pour ReportTest<br>
name&nbsp;&nbsp;&nbsp; = A Simple Test<br>
name.fr = Un simple Test<br>
info&nbsp;&nbsp;&nbsp; = This is a test report to start in Report writing 
for GenJ<br>
info.fr = Ceci est un rapport de Test pour d&eacute;marrer 
l'&eacute;criture de rapports pour GenJ<br>
author = Daniel Durand<br>
</div>
</p>

<p>
Le rapport appara&icirc;t correctement maintenant mais nous devons 
ajouter quelque chose au d&eacute;marrage pour qu'il soit utilisable 
par n'importe quel utilisateur. Par d&eacute;faut, les rapports 
peuvent &ecirc;tre lanc&eacute;s uniquement dans un contexte Gedcom - 
ceci implique que l'argument de d&eacute;marrage () doit 
&ecirc;tre une instance du type Java Gedcom. Nous le permettons 
avec <span style="font-style: italic;">context intanceofGedcom</span>. 
Une utilisation simple serait de rapporter le nombre d'individus dans
l'objet Gedcom. Nous le faisons en modifiant la m&eacute;thode de
d&eacute;part ainsi&nbsp;:<br>
<div style="margin-left: 30px;">
public void start(Object context) {<br>
 <div style="margin-left: 30px;">
 // nous savons que le contexte est une instance de Gedcom par defaut<br>
 Gedcom gedcom = (Gedcom)context;<br>
 // Comptons le nombre d'individus<br>
 int count = gedcom.getEntities(Gedcom.INDI).size()<br>
 // ... et publions-le<br>
 println("Gedcom "+gedcom.getName()+" contains "+count+" individuals");<br>
 </div>
 }
</div>
</p>

<p>
L'API pour <span style="font-style: italic;">genj.report Report</span> 
et <span style="font-style: italic;">genj.gedcom.Gedcom</span> GenJ 
contient plusieurs m&eacute;thodes pour acc&eacute;der et 
pr&eacute;senter l'information existante (voir les Javadocs GenJ pour 
en savoir plus).
</p>

<h2>Propri&eacute;t&eacute;s et internationalisation</h2>

<p>
Dans le but de permettre son internationalisation, votre rapport 
NE doit PAS imprimer des cha&icirc;nes fixes directement. Au lieu de 
cela, il doit utiliser un fichier de propri&eacute;t&eacute;s pour 
d&eacute;finir les cha&icirc;nes &agrave; imprimer, et ensuite les 
obtenir &agrave; partir de ce fichier. Ainsi, le ficher de 
propri&eacute;t&eacute;s pourra &ecirc;tre traduit dans d'autres 
langages. Par exemple, 
<span style="color: rgb(255, 0, 0);">n'&eacute;crivez pas</span> 
cela&nbsp;: <tt>println("Birth Date is")</tt>;<br>
<span style="color: rgb(51, 204, 0);">Faites</span> plut&ocirc;t :
<div style="margin-left: 30px;">
println(i18n("BirthDateIs"));
</div>
et &eacute;crivez des lignes semblables &agrave; celles-ci dans votre 
fichier de propri&eacute;t&eacute;s&nbsp;:
<div style="margin-left: 30px;">
BirthDateIs&nbsp;&nbsp;&nbsp;&nbsp;= Birth Date is<br>
BirthDateIs.fr&nbsp;= La Date de Naissance est
</div>
</p>

<h2>Options</h2>

<p>
Chaque rapport a un choix d'options, que vous pouvez facilement 
utiliser, en cr&eacute;ant des variables de classes publiques dans 
votre classe de rapport et des propri&eacute;t&eacute;s 
dans votre fichier de propri&eacute;t&eacute;s. Par exemple, laissez 
votre rapport g&eacute;n&eacute;rer du texte par d&eacute;faut, mais 
aussi la possibilit&eacute; de cr&eacute;er de l'HTML, et vous 
permettrez aux utilisateurs de pr&eacute;ciser eux-m&ecirc;mes 
ce qu'ils veulent. Commencez en cr&eacute;ant une nouvelle variable 
publique dans votre classe de rapport java&nbsp;:<br>
<div style="margin-left: 30px;">
public boolean generateHTML = true ;
</div>
et ensuite ajoutez du texte dans votre fichier de 
propri&eacute;t&eacute;s&nbsp;:<br>
<div style="margin-left: 30px;">
generateHTML = Voulez-vous g&eacute;n&eacute;rer une sortie HTML ?
</div>
chargez votre rapport, et examinez l'onglet des options pour voir 
le r&eacute;sultat.
</p>

<p>
Pour cr&eacute;er un menu d&eacute;roulant avec plusieurs choix, 
utilisez les variables publiques&nbsp;:
<div style="margin-left: 30px;">
public int outputFormat = 0;<br>
public static String[] outputFormats = { "Soundex", "Metahphone", "Double Metaphone", "NYSIIS", "Phonex" };
</div>
et ceci dans votre fichier de propri&eacute;t&eacute;s&nbsp;:
<div style="margin-left: 30px;">
outputFormat=Output format<br>
outputFormat.de=Ausgabe-Format
</div>
<br>
Il y a quelques options plus complexes disponibles. Jetez un oeil 
sur <span style="font-style: italic;">ReportEvent.java</span> pour 
plus d'exemples.
</p>

<h2>Charger plus de code Java</h2>

<p>
Tout le code&nbsp;java dans le r&eacute;pertoire des rapports 
est&nbsp;compil&eacute; par le script de compilation, et tout est 
charg&eacute; dans&nbsp;GenJ. Ainsi, si vous souhaitez utiliser 
d'autres&nbsp;classes dans votre rapport, vous avez juste &agrave; 
copier les fichiers java ou les fichiers de classes dans votre rapport, 
et ils seront charg&eacute;s en attendant que vous les utilisiez.
</p>

<p>
Par exemple, si vous souhaitez utiliser une classe DMSoundex, placez 
juste le fichier <span style="font-style: italic;">DMSoundex.java</span> 
dans le r&eacute;pertoire des rapports et lancez 
<span style="font-style: italic;">rcompile</span>. Il sera alors 
disponible pour vous, mais n'appara&icirc;tra pas comme un rapport, 
car il n'est pas une sous-classe de 
<span style="font-style: italic;">genj.report.Report</span>.
</p>

<h2>Obtenir des donn&eacute;es (Part 1): Utiliser les m&eacute;thodes&nbsp;objets</h2>

<p>
Les objets qui stockent l'information depuis le fichier GEDCOM 
poss&egrave;dent des m&eacute;thodes pour acc&eacute;der aux noms, 
dates, enfants et&nbsp;parents (mais&nbsp;pas aussi nombreuses que 
vous pourriez le souhaiter). Quelques exemples figurent ci-dessous&nbsp;:
<div style="margin-left: 30px;">
//M&eacute;thodes disponibles dans la classe Indi (Individuals)<br>
//Ce n'est pas une liste compl&egrave;te !  Juste assez pour que vous d&eacute;marriez.<br>
String getBirthAsString()   // Note: Ceci est une DATE de naissance (non un objet complet)<br>
String getDeathAsString()   // Note: Ceci est une DATE de d&eacute;c&egrave;s (non un objet complet)<br>
String getName()<br>
String getFirstName()<br>
String getLastName()<br>
Fam getFamc()               // Obtenir une famille dont cette personne est l'enfant<br>
Indi getFather()<br>
Indi getMother<br>
Indi[] getChildren()<br>
//M&eacute;thodes disponibles pour la classe Fam (Families)<br>
//Ce n'est pas une liste compl&egrave;te !  Juste assez pour que vous d&eacute;marriez.<br>
&nbsp;Indi getChild(int which)<br>
Indi[] getChildren()<br>
Indi getHusband()<br>
Indi getWife()
</div>
Vous pouvez aussi examiner la&nbsp;<span style="font-style: italic;">PropertyDate 
class</span>, et les m&eacute;thodes qui retournent ces objets 
depuis d'autres classes.
</p>

<h2>Obtenir des donn&eacute;es&nbsp;(Part 2): Utiliser les&nbsp;tags 
et les propri&eacute;t&eacute;s</h2>

<p>
Beaucoup de donn&eacute;es dans un fichier&nbsp;GEDCOM sont disponibles 
&agrave; partir de tags, plut&ocirc;t que par des m&eacute;thodes ou 
des&nbsp;objets. Par exemple, pour obtenir des informations sur la 
naturalisation d'une personne, vous 
<span style="color: rgb(255, 0, 0);">n'avez pas</span> &agrave; 
&eacute;crire ceci: <tt>indi.getNaturalization()</tt>. A la place, 
vous <span style="color: rgb(51, 204, 0);">devriez &eacute;crire</span> 
ceci&nbsp;:
<div style="margin-left: 30px;">
PropertyEvent naturalization = (PropertyEvent)indi.getProperty(new TagPath("INDI:NATU")) ;<br>
</div>
Ou vous pouvez obtenir plus d'informations avec un appel 
semblable &agrave; celui-ci&nbsp;:
<div style="margin-left: 30px;">
PropertyDate prop = (PropertyDate)indi.getProperty(new TagPath("INDI:NATU:DATE"));<br>
String dateOfNaturalization = prop.getValue() ;
</div>
Obtenir les donn&eacute;es des&nbsp;notes est un peu plus complexe. Le 
code suivant retournera des notes d'&eacute;v&eacute;nements comme une 
cha&icirc;ne. Vous pouvez l'appeler ainsi&nbsp;:
<div style="margin-left: 30px;">
  // Exemple d'utilisation<br>
  PropertyEvent immigration = (PropertyEvent)indi.getProperty(new TagPath("INDI:IMMI")) ;<br>
  String note = getNote(immigration) ;<br>
  if (note==null) note = i18n("noNote") ;<br>
  println(note) ;<br>
  <br>
  // voici le code:<br>
  <br>
  private String getNote(PropertyEvent e) {<br>
    <div style="margin-left: 20px;">
    if (e==null) return null ;<br>
    MultiLineProperty prop = checkNote(e.getProperty("NOTE")) ;<br>
    if (prop==null) return null ;<br>
    return prop.getLinesValue()  ;<br>
    </div>
  }<br>
  <br>
  /**<br>
  &nbsp;* Cherche une propri&eacute;t&eacute; de NOTE et si possible<br>
  &nbsp;* retourne la MultiLineProperty pour acc&eacute;der &agrave; sa valeur<br>
  &nbsp;*/<br>
  MultiLineProperty checkNote(Property prop) {<br>
    <div style="margin-left: 20px;">
    if (prop==null) return null ;<br>
    </div>
  <br>
  // Ca doit &ecirc;tre une 'NOTE'<br>
  if (!prop.getTag().equals("NOTE"))<br>
    <div style="margin-left: 20px;">
    return null;<br>
    </div>
  <br>
  // voit si la propri&eacute;t&eacute; est une r&eacute;f&eacute;rence de note<br>
  if (prop instanceof PropertyNote) {<br>
    <div style="margin-left: 20px;">
    // .. va &agrave; la cible r&eacute;f&eacute;rence<br>
    prop = ((PropertyNote)prop).getTarget();<br>
    </div>
  }<br>
<br>
  // voit si nous avons une propri&eacute;t&eacute; multilignes contenant<br>
  // le texte de la note maintenant<br>
  if (prop instanceof MultiLineProperty )<br>
    <div style="margin-left: 20px;">
    return (MultiLineProperty)prop;<br>
    </div>
  <br>
  // pas de proposition<br>
  return null;<br>
  }<br>
  </div>
</p>

<p>
Pour utiliser ces cha&icirc;nes&nbsp;TagPath, vous avez besoin de 
conna&icirc;tre quels codes de quatre lettres font partie du 
standard&nbsp;GEDCOM. voici deux liens avec plus d'information pour 
vous aider&nbsp;:<br>
&nbsp;<a href="http://www.math.clemson.edu/%7Ersimms/genealogy/ll/gedcom55.pdf">http://www.math.clemson.edu/~rsimms/genealogy/ll/gedcom55.pdf</a><br>
&nbsp;<a href="http://www.gendex.com/gedcom55/55gcappa.htm">http://www.gendex.com/gedcom55/55gcappa.htm</a>
</p>

<p>
Voci un tableau memento des tags les plus communs&nbsp;:<br>
&nbsp;Haut niveau : INDI (individu), FAM (Famille)<br>
&nbsp;Ev&eacute;nements : BIRT (Naissance), DEAT (D&eacute;c&egrave;s), 
IMMI (Immigration),NATU (Naturalisation), BAPT (Bapt&ecirc;me)<br>
&nbsp;Autres : CHIL (Enfant), FAMC (Famille de l'enfant), HUSB (Epoux), 
WIFE (Epouse)<br>
&nbsp;Composants: ADDR (adresse), DATE (date), NOTE (Note), PLAC (lieu)<br>
</p>

<p>
La "<a href="../view/edit.html">Fen&ecirc;tre d'Edition</a>" 
dans sa fonction Editeur Gedcom (&agrave; l'inverse de l'Editeur 
Standard), montre exactement quels tags ont des donn&eacute;es 
pour quelles entit&eacute;s, et c'est un bon moyen pour comprendre 
la structure et les &eacute;l&eacute;ments de&nbsp;GEDCOM.
</p>

<p>
Vous pouvez examiner le code&nbsp;source du rapports des Evenements 
pour voir comment ces&nbsp;Tags sont utilis&eacute;s. 
Aussi, vous pouvez examiner le fichier&nbsp;GEDCOM lui-m&ecirc;me pour 
voir quels&nbsp;tags sont des sous-tags d'autres&nbsp;tags.
</p>

<br>

</body>
</html>
