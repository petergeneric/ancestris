<html>

<body>
<h2>Schreiben von Reporten</h2>

<p>
Diese Seite erl&auml;utert Fragestellungen zum Schreiben eigener GenJ-Reporte:
<ol>
<li>Grundlagen</li>
<li>Eigenschaften und Mehrsprachigkeit</li>
<li>Optionen</li>
<li>weiteren Java-Code laden</li>
<li>Datenabfrage (Teil 1): Methoden von Objekten verwenden</li>
<li>Datenabfrage (Teil 2): Kennzeichen und Eigenschaften verwenden</li>
</ol>
</p>

<h2>Grundlagen</h2>

<p>
Ein GenJ-Report ist ein Java-Typ, der den abstrakten Typ <I>genj.report.Report</I> erweitert.
Das Schreiben eigener Funktionalit&auml;t beginnt mit der Definition einer Klasse in einer Quelldatei und dem Ablegen dieser Datei im Report-Unterverzeichnis (der Name muss mit Report* beginnen).
</p>
<p>
Angenommen wir wollen einen Test-Report namens "Test" schreiben. Erstellen Sie zun&auml;chst in ./reports eine Text-Datei mit dem Namen ReportTest.java. Dann &Uuml;bersetzen Sie die Datei durch Aufruf des compile-Skripts im selben Verzeichnis. Dieses Skript startet javac - den Java-Compiler. Als Ergebnis erhalten wir eine Datei namens ReportTest.class, die GenJ laden und ausf&uuml;hren kann nachdem sie in der <A href="../view/report.html">Report-Ansicht</A> ausgew&auml;hlt wurde.
</p>

<P>
Sehen wir uns das Muster ReportTest.java an. Es enth&auml;lt eine public class-Definition, die
den Report-Vereinbarungen entspricht (<I>extends Report</I>). Teil dieser Vereinbarung ist die
Implementierung von <i>public void start(Object context)</i> - dem Einstiegspunkt des Reports. Wir k&ouml;nnen alle von der Oberklasse Report bereitgestellten Methoden verwenden - hier benutzen wir
deren println-Methode - <i>println()</i> f&uuml;llt ein Widget mit Text, den der Benutzer bei Ausf&uuml;hrung des Reports sieht.

 <PRE>

  import genj.gedcom.*;
  import genj.report.*;

  import genj.report.Report;

  public class ReportTest extends Report {

    /**
     * die Haupt-Methode ("main")
     */
    public void start(Object context) {
      println("Hallo Welt!");
    }

  }
 </PRE>
</p>

<p>
 Nun wollen wir den Report mit Namen, einigen grundlegenden Informationen und der Angabe des Autors in die <A href="../view/report.html">Report-Ansicht</A> integrieren. 
 Um dies zu erreichen erstellen wir im selben Verzeichnis die Datei ReportTest.properties und f&uuml;llen sie mit den notwendigen Informationen wie beispielsweise:
 <pre>
  # Datei: ReportTest.properties
  # Dies sind die Text-Bausteine f&uuml;r ReportTest
  name   = Ein einfacher Test
  info   = Dies ist ein Test-Report, um das Schreiben von GenJ-Reporten zu erlernen
  author = Carsten M&uuml;ssig
 </pre>
</p>

<p>
 Nun wird der Report vern&uuml;ftig angezeigt, jedoch sollte er etwas in start() tun, um f&uuml;r einige Benutzer interessant zu sein. Per Definition k&ouml;nnen Reporte nur auf einem Gedcom-Kontext ausgef&uuml;hrt werden - dies bedeutet, dass das Argument von start() eine Instanz des Java-Typs <i>Gedcom</i> sein muss. Also nehmen wir an, dass <i>context instanceof Gedcom</i>.
 Ein einfacher Anwungsfall k&ouml;nnte die Ausgabe der Personenzahl im &uuml;bergebenen Gedcom-Objekt sein. Wir erreichen dies durch eine &Auml;nderung der oben angegebenen start-Methode:
 <pre>
    public void start(Object context) {
      // wir wissen, dass context per Definition eine Instanz von Gedcom ist
      Gedcom gedcom = (Gedcom)context;
      // Anzahl der Personen berechnen
      int count = gedcom.getEntities(Gedcom.INDI).size()
      // ... Ausgabe
      println("Gedcom "+gedcom.getName()+" umfasst "+count+" Personen");
    }
 </pre>
</p> 


<P>
Die API f&uuml;r genj.report.Report und genj.gedcom.Gedcom enth&auml;lt eine Reihe von Methoden zum
Zugriff und zur Anzeige der enhaltenen Informationen (siehe GenJ-Javadocs f&uuml;r mehr).
</P>

<h2>Eigenschaften und Mehrsprachigkeit</h2>

<p>
Um Mehrsprachigkeit zu unterst&uuml;tzen sollte Ihr Report nicht direkt Zeichenketten ausgeben.
Stattdessen sollte eine properties-Datei verwendet werden, um die auszugebenden Zeichenketten festzulegen und die Strings aus der Datei angezeigt werden. In dieser Variante kann der Inhalt der properties-Datei in andere Sprachen &uuml;bersetzt werden.
Machen Sie z. B. <FONT COLOR=RED>nicht</FONT> folgendes: <tt>println("Geburtsdatum ist");</tt><br>
Tun Sie <FONT COLOR=GREEN>dieses</FONT>:
<pre>
    println(i18n("BirthDateIs"));
</pre>
und erstellen Sie einen entsprechenden Eintrag in der properties-Datei:
<pre>
    BirthDateIs = Geburtsdatum ist
</pre>

<h2>Optionen</h2>

<p>
Jeder Report hat eine Options-Anzeige, die Sie auf einfache Art und Weise durch Anlegen von public-Variablen in der Report-Klasse und Eintr&auml;gen in der properties-Datei nutzen k&ouml;nnen. Nehmen wir an Ihr Report erzeugt standardm&auml;&szlig;ig Text, kann aber auch HTML erstellen und das Ausgabeformat soll durch den Benutzer festgelegt werden. Beginnen wir mit dem Anlegen einer neuen public-Variablen in der Report-Klasse:
<pre>
    public boolean generateHTML = true ;
</pre>
und f&uuml;gen jetzt den Text zur properties-Datei hinzu:
<pre>
    generateHTML = Soll die Ausgabe in HTML erstellt werden?
</pre>
Laden Sie den Report und werden Sie einen Blick auf die Optionen, um das Ergebnis zu sehen.
</p>

<p>
Verwenden sie folgende public-Variablen, um ein PullDown-Men&uuml; mit einigen Auswahlm&ouml;glichkeiten zu erstellen:
<pre>
    public int outputFormat = 0;
    public static String[] outputFormats = { "Soundex", "Metahphone", "Double Metaphone", "NYSIIS", "Phonex" };
</pre>
und erg&auml;zen Sie dies in der properties-Datei:
<pre>
    outputFormat=Output format
    outputFormat.de=Ausgabe-Format
</pre>
Es gibt einige komplexere Optionen. Bitte sehen Sie sich dazu ReportEvent.java an.
</p>
<h2>weiteren Java-Code laden</h2>

<p>
Der Java-Code im report-Verzeichnis ist mit dem rcompile-Skript &uuml;bersetzt und wird in GenJ geladen. Wenn Sie also andere Klassen in Ihrem Report verwenden wollen kopieren Sie die Java-Dateien in Ihren Report, damit sie geladen werden.
</p>

<p>
Wenn Sie beispielsweise die Klasse DMSoundex verwenden wollen legen Sie die DMSoundex.java-Datei in das Report-Verzeichnis und starten Sie rcompile. Nun ist die Datei zwar verf&uuml;gbar, erscheint aber nicht als ein Report, da sie nicht von genj.report.Report abgeleitet ist.

<h2>Datenabfrage (Teil 1): Methoden von Objekten verwenden</h2>

Die Java-Objekte, die Informationen aus einer GEDCOM-Datei speichern, besitzen Methoden, um auf Namen, Zeitangaben, Kinder und Eltern zuzugreifen (aber nicht so viele, wie Sie vielleicht erwarten).
Nachfolgend einige Beispiele:
<pre>
    //Methoden der Klasse Indi (Personen)
    //Diese Liste ist nicht vollst&auml;ndig!  F&uuml;r den Einstieg jedoch genug.
    String getBirthAsString()   // Hinweis: dies ist ein Geburtsdatum (kein Objekt)
    String getDeathAsString()   // Hinweis: dies ist ein Todesdatum (kein Objekt)
    String getName()
    String getFirstName()
    String getLastName()
    Fam getFamc()               // ermittelt die Familie, in der diese Person Kind ist
    Indi getFather()
    Indi getMother
    Indi[] getChildren()
    //Methoden der Klasse Fam (Familien)
    //Diese Liste ist nicht vollst&auml;ndig!  F&uuml;r den Einstieg jedoch genug.
    Indi getChild(int which)
    Indi[] getChildren()
    Indi getHusband()
    Indi getWife()
</pre>
Sie sollten sich auch die Klasse PropertyDate und die Methoden, die solche Objekte aus anderen Klassen zur&uuml;ckliefern, ansehen.

<h2>Datenabfrage (Teil 2): Kennzeichen und Eigenschaften verwenden</h2>

<p>
Die meisten Daten in einer GEDCOM-Datein sind &uuml;ber Kennzeichen verf&uuml;gbar. Um beispielsweise die Einb&uuml;rgerungs-Informationen einer Person zu erhalten ist <FONT COLOR=RED>
nicht</FONT>&nbsp;<TT>indi.getNaturalization()</TT> aufzurufen, <FONT COLOR=GREEN>sondern:</FONT> this:
<pre>
PropertyEvent naturalization = (PropertyEvent)indi.getProperty(new TagPath("INDI:NATU")) ;
</pre>
Oder Sie k&ouml;nnen andere spezifische Daten mit Aufrufen wie:
<pre>
PropertyDate prop = (PropertyDate)indi.getProperty(new TagPath("INDI:NATU:DATE"));
String dateOfNaturalization = prop.getValue() ;
</pre>
ermitteln. An Notizen zu kommen ist etwas aufwendiger. Sofern eine Notiz vorhanden ist gibt folgender Code die Notiz zu einem Ereignis als String zur&uuml;ck. Der Aufruf sieht wie folgt aus:
<pre>

   // Anwendungsbeispiel:
   PropertyEvent immigration = (PropertyEvent)indi.getProperty(new TagPath("INDI:IMMI")) ;
   String note = getNote(immigration) ;
   if (note==null) note = i18n("noNote") ;
   println(note) ;

   // aufgerufener Code:

   private String getNote(PropertyEvent e) {
       if (e==null) return null ;
       MultiLineProperty prop = checkNote(e.getProperty("NOTE")) ;
       if (prop==null) return null ;
       return prop.getLinesValue()  ;
   }

  /**
   * Checks for a NOTE property and if applicable
   * return the MultiLineProperty for accessing its value
   */
  MultiLineProperty checkNote(Property prop) {
       if (prop==null) return null ;

    // has to be 'NOTE'
   if (!prop.getTag().equals("NOTE"))
     return null;

    // see if prop is a reference to a Note
    if (prop instanceof PropertyNote) {
      // .. jump to the referenced target
      prop = ((PropertyNote)prop).getTarget();
    }

    // see if we have a multiline property containing
    // the note text now
    if (prop instanceof MultiLineProperty )
      return (MultiLineProperty)prop;

    // no candidate
    return null;
  }
</pre>

<p>
Die Verwendung von Kennzeichnungspfaden setzt Kenntnisse &uuml;ber GEDCOM-konforme Abk&uuml;rzungen, die eine L&auml;nge von vier Buchstaben haben, voraus. Hier zwei Verweise mit weiteren Informationen:
<BR>
&nbsp;<A HREF="http://www.math.clemson.edu/~rsimms/genealogy/ll/gedcom55.pdf">http://www.math.clemson.edu/~rsimms/genealogy/ll/gedcom55.pdf</A><BR>
&nbsp;<A HREF="http://www.gendex.com/gedcom55/55gcappa.htm">http://www.gendex.com/gedcom55/55gcappa.htm</A>
</p>

<P>
Nachfolgend die am h&auml;ufigsten verwendeten Kennzeichnungen:<BR>
&nbsp;oberste Ebene: INDI (Person), FAM (Familie)<BR>
&nbsp;Ereignisse: BIRT (Geburt), DEAT (Tod), IMMI (Immigration),NATU (Einb&uuml;rgerung), BAPT (Taufe)<BR>
&nbsp;weitere: CHIL (Kind), FAMC (Kind in Familie), HUSB (Ehemann), WIFE (Ehefrau)<BR>
&nbsp;Bestandteile: ADDR (Addresse), DATE (Datum), NOTE (Notiz), PLAC (Ort)<BR>
</p>

<p>
Die "Editier-Ansicht" zeigt genau welche Kennzeichnungen Daten zu welchen Instanzen haben und ist eine gute M&ouml;glichkeit, um die Daten und die Struktur von GEDCOM zu verstehen.
</p>

<p>
Sehen Sie sich den Quellcode des Event-Reports an, um besser zu verstehen wie Kennzeichnungen verwendet werden. Weiterhin k&ouml;nnen Sie eine GEDCOM-Datei einsehen, um nachzuschauen welche Kennzeichnungen von anderen Kennzeichnungen umgeben sind.
</p>

</body></html>