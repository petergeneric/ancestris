<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <title>Batches and Semantic Web mash ups</title>
        <link rel="stylesheet" href="./ancestris.css" type="text/css">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="./ancestris.css">
    </head>
    <body>
        <a name="_Top_"></a>
        <center>
            <h2 class="ancestris_help_title">Batches and Semantic Web mash ups</h2>
        </center>
        <br>
        <table border="0" width="100%">
            <tr>
                <td width="65%">
                    &nbsp;
                </td>
                <td width="35%">
                    <p style="font-style: italic; text-align: justify;
                    text-justify: newspaper; font-size: 10px;">
                        <font color="#0b7700"><u>Author</u></font>: Jo Pol.<br>
                        <font color="#0b7700"><u>Maintenance</u></font>: Jo Pol, You.
                    </p>
                </td>
             </tr>
        </table>
        <br>

        <p class="justify">
            With external tools you can query more than just a single family tree,
            or create a batch that generates multiple reports in one go.
        </p>
        <ul>
            <li> <a href="rdf-mashup.html#semantic-intro">Introduction to the semantic web</a></li>
            <li> <a href="rdf-mashup.html#batches">Batches</a></li>
            <li> <a href="rdf-mashup.html#setenv">Set Environment Variables</a></li>
            <li> <a href="rdf-mashup.html#GeoNameIDs">GeoNameIDs</a></li>
            <li> <a href="rdf-mashup.html#FAQ">FAQ</a></li>
        </ul>

        <a name="semantic-intro"></a>
        <h3 class="ancestris_help_title">Introduction to the semantic web</h3>

        <p class="justify">
            This is a very brief introduction but it should have the most important
            pointers to start browsing the web about the subject.
            The semantic web uses triples of URI's: subject predicate object.
            These triples are also called statements.
            These triples can be stored in different formats. RDF is the most widely supported format.
            The turtle format is much less verbose and therefore easier to read.
            The triples get meanings with ontologies (also expressed in triples)
            though a human can guess a lot without following the mathematical definitions.
            The mother of all ontologies is OWL. An ontology also implies inference. 
            For example: A isAncesterOf B, B isAncestorOf C -> A isAncestorOf C.
            At the moment applying full-fledged inference is slow. Common practice
            is to apply just the rules you actually need.
        </p>
        <p class="justify">
            The conversion performed by the plugin does not comply to an established ontology.
            Cross site queries and inference would be easier when using
            something like FOAF or a similar ontology. 
            The chosen format however was quick and easy to implement
            and is easy to recognise by GedCom tigers.
            It might be wise to monitor for ontologies that might emerge and could
            replace the quick-and-dirty approach.
            A start is made with an ontology to bridge the gap between the unorthodox format and the web.
            The status is not clear but you can find the plain text file
        </p>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="http://arvernes.dyndns.org/fgenj/trunk/AncestrisExtensions/report.rdf/src/genjreports/rdf/GedcomTags.ttl">
            <param name="text" value="<html><u>in the code base</u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object><br/>
        <p class="justify">
            The current GUI lets you query just a single family tree. 
            The batch commands however allow to 
            cross-query multiple family trees and/or data from the web.
            DbPedia could be an interesting almanac, 
            for example to find famous contemporary local people.
            GeoNames is interesting for maps.
        </p>
        <p class="justify">You may find more interesting resources via</p>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="http://richard.cyganiak.de/2007/10/lod/">
            <param name="text" value="<html><u>the LOD cloud diagram</u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="http://www.w3.org/wiki/SparqlEndpoints">
            <param name="text" value="<html><u>a wiki list of SPARQL end points</u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="http://labs.mondeca.com/sparqlEndpointsStatus/">
            <param name="text" value="<html><u>a list with the status of SPARQL end points</u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object>


        <a name="batches"></a>
        <h3 class="ancestris_help_title">Batches</h3>

        <p class="justify">
            The plugin uses the jena library to perform its tasks. 
            Jena.apache and other products also have command line tools for similar tasks.
            The plugin functionality can also be executed from a command line.
            Thus you can assemble a list of reports you want to run every once in while,
            in stead of having to launch them one by one.
            Below some examples of commands. 
            Run without arguments to show all possible arguments.
        </p>
<pre>
java %JAVA_OPTS% genjreports.rdf.GedcomToRdf<u>Converter</u> -rules slowRules.txt -gedcom family.ged > gedcom.ttl
java %JAVA_OPTS% genjreports.rdf.semweb.<u>Select</u> muInput.tsv gedcom.ttl muOutput.ttl <u>mashup.arq</u>
java %JAVA_OPTS% genjreports.rdf.semweb.<u>Mashup</u> muInput.tsv http://my.dom.com/gc/places/ muOutput.ttl "de|fr"
java %JAVA_OPTS% genjreports.rdf.semweb.<u>Select</u> report.txt gedcom.ttl muOutput.ttl *.rdf <u>classmates.arq</u>
</pre>
        <ul>
          <li>
            Before these commands will run you will have to
            <a href="#setenv">set</a> some environment variables.
          </li>
          <li>On Mac / Unix %JAVA_OPTS% becomes $JAVA_OPTS$.</li>
          <li>
            The selection command allows to run a query against
            multiple sources. The report view runs queries just against
            the converted gedcom. 
          </li>
          <li>
            The GUI allows to run reports for a specific entity, 
            something the command line can't: you would have to duplicate the queryfile
            and replace %s manually with the desired ID.
          </li>
          <li>
            The mashup command builds a bridge between your family data
            and data on the web. This command is not (yet?) available in the GUI.
          </li>
          <li>
            The Mashup commands takes some 6 minutes and creates about 250KB
            with the <a href="./mashup/kennedyMashupInput.tsv">Kennedy</a> example,
          </li>
        </ul>
        <p class="justify">
            
        </p>
        <p class="justify">
            The commands and their files above are shown in the following diagram.
            Note that muInput.tsv is output for one command and input for the next
        </p>
        <img src="./images/chart.jpg"/>



        <a name="#setenv"></a>
        <h3 class="ancestris_help_title">Set Environment Variables</h3>
        <p class="justify">
            The batch commands need some environment variables. The files
            <a href="./mashup/setenv.bat">setenv.bat</a> (for Windows) and
            <a href="./mashup/setenv.sh">setenv.sh</a> (for Mac / Unix)
            are examples to set them, you will have to adjust them
            depending on the configuration of your system. 
        </p>
        <p class="justify">
            The example value for the variable MODS is for a beta release of Ancestris.
            For an official release replace "trunk" with the release number, for example "0.8".
            Other components of the paths may vary depending on the configuration
            of your operating system.
        </p>
        <p class="justify">
            Until deivered along with Ancestris, you need to download the jars listed 
            <a href="forum.ancestris.org/index.php?topic=76.msg192">here</a>
            and add the download folder to the classpath.
        </p>
        <p class="justify">
            Mashup shows progress with logging which can be customised with
            <a href="./mashup/log4j.properties">log4j.properties</a>
            and the variable JAVA_OPTS. 
            The mashup will work without this file,
            but logging will be limioted to a warning and not produce progress information.
        </p>



        <a name="#GeoNameIDs"></a>
        <h3 class="ancestris_help_title">GeoNameIDs</h3>



        <p class="justify">
            GeoNameIDs can create a bridge between
            your family data and the data on the web. 
            The file <code>muOutput.ttl</code> in the diagram is the bridge,
            the mashup command builds the bridge.
            As long as the geo plugin does not provide an export,
            you will have to create the file <code>muInput.tsv</code>
            with the <a href="./mashup/mashup.arq">mashup query</a>.
            The first time you run the query,
            it won't produce GeoName URI's in the first column.
        </p>

        <p class="justify">
            The mashup command needs a tab separated file as input,
            so make sure to run the mashup query with tsv as output.
            You will have to add missing GeoNameIDs in the first column.
            You might use a spreadheet program,
            but make sure to save as a tab separated file,
            <a href="./images/saveAsTextWithTabs.jpg">screenshot</a>.
            Keep the places in the second column,
            together with all their jurisdictions and separators between them.
            Search the places on www.geonames.org with the show-on-map button
            The balloons with details shows a GeoNameId:
        </p>
        <img src="./images/FindGeoNamesID.jpg"/>.


        <a name="FAQ"></a>
        <h3 class="ancestris_help_title">FAQ</h3>

        <dl>
            <dt>What properties are commonly available?</dt>
            <dd>Try the mashup queries:
                <ul>   <li><a href="./mashup/geonamesProperties.arq">geonamesProperties.arq</a>
                  </li><li><a href="./mashup/geonamesRelatedEntities.arq">geonamesRelatedEntities.arq</a>
                  </li><li><a href="./mashup/dbpediaRelatedEntities.arq">dbpediaRelatedEntities.arq</a>
                  </li><li><a href="./mashup/dbpediaProperties.arq">dbpediaProperties.arq</a>
                  </li>
                </ul>
            </dd>
            <dt>Does DbPedia have resources in my language?</dt>
            <dd><p>Try the mashup query <a href="./mashup/geonamesProperties.arq">dbpediaLanguages.arq</a>
                   Note that not all can be queried directly.
                </p>
            </dd>
            <dt>Some places do have a GeoNameID in the mashup input, 
                but <a href="./mashup/mashup.arq">mashup.arg</a> shows no coordinates.
            </dt>
            <dd><p>
                The free services of GeoNames and DbPedia are not allways reliable
                so you might have to repeat <a href="./mashup/mashup.bat">mashup.bat</a>
                or <a href="./mashup/mashup.sh">mashup.sh</a>.
                The mashup command is designed not to download from GeoNames again
                what is already present. DbPedia is allways queried to create direct links,
                but nothing is downloaded because it is too much and can be queried directly.
            </p></dd>
            <dt>...</dt>
            <dd><p>...</p></dd>
        </dl>
        <p class="justify">FAQ about jena command utils</p>
        <dl>
            <dt>The <code>arq</code> command complains about prefixes.</dt>
            <dd><p>This might have one of the following causes:</p>
                <p>a) Remove the warnings
                   in your variant of <code>merged.n3</code>
                </p><p>
                   b) The mashup example contains explicit namespace prefixes.
                   The other <a href="rdf-examples.html">examples</a> don't, the plugin fills in the prefixes.
                   So copy the required prefixes of the mashup query into the other queries 
                   if you want to use them with the command line.
                </p>
            </dd>
            <dt>The <code>arq</code> command complains about Triples not terminated by DOT</dt>
            <dd><p class="justify">
                   The format N3 and TTL may reduce the predicates
                   <code>rdf:type</code> and <code>owl:sameAs</code> to
                   "a" respectively "=". 
                   It looks like <code>arq</code> does not (yet?) support the latter. 
                   So replace the predicate "=" by "owl:sameAs"
                   in the file <code>merged.n3</code>
                </p>
            </dd>
            <dt>The XML produced by the plugin looks like a nice table
               (at least in an IE tab of Firefox), the batch produces plain xml.
            </dt>
            <dd><p class="justify">
                   The plugin inserts an XSLT reference into the xml. 
                   Browsers may apply that transformation into HTML.
                   You may choose to do XSLT processing with JavaScript or 
                   insert on XSLT reference manually, add as second line:
                </p>
               <pre>&lt;?xml-stylesheet type="text/xsl" href="http://www.w3.org/TR/rdf-sparql-XMLres/result-to-html.xsl"?&gt;</pre>
                <p class="justify">
                   NOTE that most browsers don't like cross-site scripting,
                   so save the XSL file in the same domain as your query result.
                </p>
            </dd>
        </dl>
        <br>
        <br>
        <br>
        <br>
        <a href="rdf-todo.html#_Top_">Top</a>
        <br>
        <br>
    </body>
</html>
<!--
Tip: to create a link which will open in an external web browser, outside a paragraph:
<object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
    <param name="content" value="http://www.netbeans.org/">
    <param name="text" value="<html><u>http://www.netbeans.org/</u></html>">
    <param name="textFontSize" value="medium">
    <param name="textColor" value="blue">
</object>
To create a link to a help set from another module, you need to know the code name base and path, e.g.:
<a href="nbdocs://org.netbeans.modules.usersguide/org/netbeans/modules/usersguide/configure/configure_options.html">Using the Options Window</a>
(This link will behave sanely if that module is disabled or missing.)
-->