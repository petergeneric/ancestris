<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <title>Batches and Semantic Web mash ups</title>
        <link rel="stylesheet" href="./ancestris.css" type="text/css">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="./ancestris.css">
    </head>
    <body>
        <a name="_Top_"></a>
        <center>
            <h2 class="ancestris_help_title">Batches and Semantic Web mash ups</h2>
        </center>
        <br>
        <table border="0" width="100%">
            <tr>
                <td width="65%">
                    &nbsp;
                </td>
                <td width="35%">
                    <p style="font-style: italic; text-align: justify;
                    text-justify: newspaper; font-size: 10px;">
                        <font color="#0b7700"><u>Author</u></font>: Jo Pol.<br>
                        <font color="#0b7700"><u>Maintenance</u></font>: Jo Pol, You.
                    </p>
                </td>
             </tr>
        </table>
        <br>

        <p class="justify">
            With external tools you can query more than just a single family tree,
            or create a batch that generates mutiple reports in one go.
        </p>
        <ol>
            <li> <a href="rdf-mashup.html#semantic-intro">Introduction to the semantic web</a></li>
            <li> <a href="rdf-mashup.html#batches">Batches in short</a></li>
            <li> <a href="rdf-mashup.html#mashup">Mash up in short</a></li>
            <li> <a href="rdf-mashup.html#FAQ">FAQ</a></li>
        </ol>

        <a name="semantic-intro"></a>
        <h3 class="ancestris_help_title">Introduction to the semantic web</h3>

        <p class="justify">
            This is a very brief introduction but it should have the most important
            pointers to start browsing the web about the subject.
            The semantic web uses triples of URI's: subject predicate object.
            These triples can be stored in different formats. RDF is the most widely supprted format.
            The turtle format is much less verbose and therefore easier to read.
            The triples get meanings with ontologies (also expressed in triples)
            though a human can guess a lot without following the mathematical definitions.
            The mother of all ontologies is OWL. An ontology also implies inference. 
            For example: A isAncesterOf B, B isAncestorOf C -> A isAncestorOf C.
            At the moment applying full-fledged inference is slow. Common practice
            is to apply just the rules you actually need.
        </p>
        <p class="justify">
            The conversion performed by the plugin does not comply to an established ontology.
            Cross site queries and inference would be easier when using
            something like FOAF or a similar ontology. 
            The chosen format however was quick and easy to implement
            and is easy to recognise by GedCom tigers.
            It might be wise to monitor for ontologies that might emerge and could
            replace the quick-and-dirty approach.
            A start is made with an ontology to bridge the gap between the unortodox format and the web.
            The status is not clear but you can find the plain text file
        </p>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="http://arvernes.dyndns.org/fgenj/trunk/AncestrisExtensions/report.rdf/src/genjreports/rdf/GedcomTags.ttl">
            <param name="text" value="<html><u>in the code base</u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object><br/>

        <a name="batches"></a>
        <h3 class="ancestris_help_title">Batches in short</h3>

        <p class="justify">
            The plugin uses the jena library to perform its tasks. 
            Jena has also command line tools that can perform the same tasks and more, 
            except for the conversion from the gedcom to triples.
            Jena is just an example of available tools.
            You can use the command line tools for mashups and/or
            create batches to run multiple queries with a single command.
        </p>

        <h4>More than you want to know:</h4>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="jena.apache.orghttp://jena.apache.org/documentation/query/cmds.html">
            <param name="text" value="<html><u></u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object>

        <h4>The least you want to know:</h4>
        <p class="justify">
            Look for downloads via the link above, get apache-jena and unpack it. 
            Open a command line window and adjust <code>x.y.z</code> and each <code>PATH_TO</code>
            in the commands below to your situation. 
            Note that the variable JENAROOT is not just to provide shorthands,
            but is required by the other commands.
            Creation and using the file <code>merged.n3</code> is optional,
            it is intended for data downloaded from the web. 
            The option <code>--help</code> explains more about the commands.
        </p>
        <p>Windows</p>
        <pre>
            set JENAROOT=C:\PATH_TO\apache-jena-x.y.z
            %JENAROOT%\bat\rdfcat.bat -out N3 c:\PATH_TO_DOWNLOADS\*.rdf > merged.n3
            %JENAROOT%\bat\arq.bat --graph merged.n3 --graph gedcom.ttl --query mashup.arq > result.txt
        </pre>
        <p>Mac / Unix</p>
        <pre>
            set JENAROOT=/PATH_TO/apache-jena-x.y.z
            $JENAROOT/bin/rdfcat -out N3 /PATH_TO_DOWNLOADS/*.rdf > merged.n3
            $JENAROOT/bin/arq --graph merged.n3 --graph gedcom.ttl --query mashup.arq > result.txt
        </pre>

        <a name="mashup"></a>
        <h3 class="ancestris_help_title">Mash up in short</h3>

        <a name="rdf-data"></a>
        <p class="justify">
            The plugin lets you query just a single family tree. 
            The used techniques however allow to 
            cross-query multiple family trees and/or data from the web.
            DbPedia could be an interesting almanac, 
            for example to find famous contemporary local people.
            GeoNames is interesting for maps.
            For a start you could download some intersting cities that are relevant for your family-tree.
        </p>
        <p>A DBPedia example:</p>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="http://dbpedia.org/data/Berlin.n3">
            <param name="text" value="<html><u>http://dbpedia.org/page/Berlin</u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object>
        <p>Amsterdam from GeoNames</p>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="http://sws.geonames.org/2759794/about.rdf">
            <param name="text" value="<html><u>http://www.geonames.org/2759794/amsterdam.html</u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object>
        <p>You may find more intersting resources via the</p>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="http://richard.cyganiak.de/2007/10/lod/">
            <param name="text" value="<html><u>LOD cloud diagram</u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object>
        <p class="justify">
            The merge command shown above allows to collect any data you want. 
            The procedure below is a semi-automated method to collect related data 
            From GeoNames and DbPedia.
        </p>
        <p class="justify">
            The required files:
        </p>
        <ul>
            <li>Your gedcom converted to ttl, n3 or rdf.
            </li>
            <li><a href="./kennedy-mashup/mashup.arq">mashup.arq</a>
                a sample query, you may want to select other properties.
            </li>
            <li>
                A tab separated file with GeoNameId's paired with
                unique values of INDI:*:PLAC and/or FAM:*:PLAC.<br/>
                An example with just a few places for the Kennedy tree:
                <a href="./kennedy-mashup/mashupInput.txt">mashupInput.txt</a>
            </li>
        </ul>
        <p class="justify">
            Get the places with the mashup query as shown above
            but without using the <code>merged.n3</code> file. 
        </p>
        <p class="justify">
            Search the places on www.geonames.org with the show-on-map button
            The baloons with details shows a GeoNameId.
            Create a the <code>mashupInput.text</code> from the query results and found IDs.
            See <a href="./images/FindGeoNamesID.jpg">screenshot</a>.
        </p>
        <p class="justify">
            The following commands download an merge the data.
            The example is for Windows-7 and a beta release of Ancestris.
            For an official release replace "trunk" with the release number, for example "0.8",
            Other components of the path may vary depending on the configuration
            of your operating system.
        </p>
        <pre>
            set CLASSPATH=%CLASSPATH%;C:\Users\username\Appdata\Roaming\.ancestris\trunk\modules\genjreports-rdf.jar
            set CLASSPATH=%CLASSPATH%;C:\Users\username\Appdata\Roaming\.ancestris\trunk\modules\ext\jena-2.6.4.jar
            set CLASSPATH=%CLASSPATH%;C:\Users\username\Appdata\Roaming\.ancestris\trunk\modules\ext\arq-2.8.7.jar
            java genjreports.rdf.semweb.Mashup mashupInput.txt http://my.domain.com/gedcom/places/ merged.n3</pre>
        </pre>
        <p class="justify">
            Run the mashup query again but now with the <code>merged.n3</code> file.
        </p>
        <a name="FAQ"></a>
        <h3 class="ancestris_help_title">FAQ</h3>

        <dl>
            <dt>The <code>arq</code> command complains about prefixes.</dt>
            <dd><p>This might have one of the following causes:</p>
                <p>a) Remove the warninngs about illegal characters
                   in your variant of <code>merged.n3</code>
                </p><p>
                   b) The mashup example contains explicit namespace prefixes.
                   The other <a href="rdf-examples.html">examples</a> don't, the plugin fills in the prefixes.
                   So copy the required prefixes of the mashup query into the other queries 
                   if you want to use them with the command line.
                </p>
            </dd>
            <dt>The <code>arq</code> command complains about Triples not terminated by DOT</dt>
            <dd><p class="justify">
                   The format N3 and TTL may reduce the predicates
                   <code>rdf:type</code> and <code>owl:sameAs</code> to
                   "a" respectively "=". 
                   It looks like <code>arq</code> does not (yet?) support the latter. 
                   So replace the predicate "=" by "owl:sameAs"
                   in the file <code>merged.n3</code>
                </p>
            </dd>
            <dt>The XML produced by the plugin looks like a nice table, the batch produces plain xml.</dt>
            <dd><p class="justify">
                   The plugin inserts an XSLT reference into the xml. 
                   Browsers apply that transformation into HTML.
                   With the batch tool, you have to insert that XSLT reference by yourself, add as second line:
                </p>
               <pre>&lt;?xml-stylesheet type="text/xsl" href="http://www.w3.org/TR/rdf-sparql-XMLres/result-to-html.xsl"?&gt;</pre>
                <p class="justify">
                   NOTE that most browsers don't like cross-site scripting,
                   so save the XSL file in the same domain as your query result.
                </p>
            </dd>
            <dt>What dbPedia properties are commonly available?</dt>
            <dd>
                <p>Find available properties in a variation of the following query</p>
                <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
                    <param name="content" value="http://dbpedia.org/snorql/?query=SELECT+DISTINCT+%3Fproperty%0D%0A{+%3Fsettlement+%0D%0A++++rdf%3Atype+%3Chttp%3A%2F%2Fdbpedia.org%2Fontology%2FSettlement%3E%3B%0D%0A++++%3Chttp%3A%2F%2Fdbpedia.org%2Fontology%2Fcountry%3E+%3ANetherlands%3B%0D%0A++++%3Fproperty+%3Fvalue%0D%0A}%0D%0AORDER+BY+DESC%28%3Fsettlement+%29">
                    <param name="text" value="<html><u>dbpedia.org/snorql</u></html>">
                    <param name="textFontSize" value="medium">
                    <param name="textColor" value="blue">
                </object>
                <p>Try interesting properties in a variation of the following query</p>
                <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
                    <param name="content" value="http://dbpedia.org/snorql/?query=SELECT+DISTINCT+*+%0D%0A{+%3Fsettlement+%0D%0A++++rdf%3Atype+%3Chttp%3A%2F%2Fdbpedia.org%2Fontology%2FSettlement%3E%3B%0D%0A++++%3Chttp%3A%2F%2Fdbpedia.org%2Fontology%2Fcountry%3E+%3ANetherlands.%0D%0A++OPTIONAL+{%3Fsettlement+dbpedia2%3Apopulation+%3Fpopulation}%0D%0A++OPTIONAL+{%3Fsettlement+dbpedia2%3ApopulationAsOf+%3FpopulationAsOf}%0D%0A}%0D%0AORDER+BY+DESC%28%3Fsettlement+%29">
                    <param name="text" value="<html><u>dbpedia.org/snorql</u></html>">
                    <param name="textFontSize" value="medium">
                    <param name="textColor" value="blue">
                </object>
                <p>The restriction to a smaller region keeps the queries relatively quick.</p>
            </dd>
            <dt>...</dt>
            <dd><p>...</p></dd>
        </dl>
        <br>
        <br>
        <br>
        <br>
        <a href="rdf-todo.html#_Top_">Top</a>
        <br>
        <br>
    </body>
</html>
<!--
Tip: to create a link which will open in an external web browser, outside a paragraph:
<object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
    <param name="content" value="http://www.netbeans.org/">
    <param name="text" value="<html><u>http://www.netbeans.org/</u></html>">
    <param name="textFontSize" value="medium">
    <param name="textColor" value="blue">
</object>
To create a link to a help set from another module, you need to know the code name base and path, e.g.:
<a href="nbdocs://org.netbeans.modules.usersguide/org/netbeans/modules/usersguide/configure/configure_options.html">Using the Options Window</a>
(This link will behave sanely if that module is disabled or missing.)
-->