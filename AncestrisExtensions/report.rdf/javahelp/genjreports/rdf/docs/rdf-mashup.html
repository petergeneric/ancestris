<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <title>Batches and Semantic Web mash ups</title>
        <link rel="stylesheet" href="./ancestris.css" type="text/css">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="./ancestris.css">
    </head>
    <body>
        <a name="_Top_"></a>
        <center>
            <h2 class="ancestris_help_title">Batches and Semantic Web mash ups</h2>
        </center>
        <br>
        <table border="0" width="100%">
            <tr>
                <td width="65%">
                    &nbsp;
                </td>
                <td width="35%">
                    <p style="font-style: italic; text-align: justify;
                    text-justify: newspaper; font-size: 10px;">
                        <font color="#0b7700"><u>Author</u></font>: Jo Pol.<br>
                        <font color="#0b7700"><u>Maintenance</u></font>: Jo Pol, You.
                    </p>
                </td>
             </tr>
        </table>
        <br>

        <p class="justify">
            With external tools you can query more than just a single family tree,
            or create a batch that generates mutiple reports in one go.
        </p>
        <ol>
            <li> <a href="rdf-mashup.html#semantic-intro">Introduction to the semantic web</a></li>
            <li> <a href="rdf-mashup.html#batches">Batches in short</a></li>
            <li> <a href="rdf-mashup.html#mashup">Mash up in short</a></li>
            <li> <a href="rdf-mashup.html#FAQ">FAQ</a></li>
        </ol>

        <a name="semantic-intro"></a>
        <h3 class="ancestris_help_title">Introduction to the semantic web</h3>

        <p class="justify">
            This is a very brief introduction but it should have the most important
            pointers to start browsing the web about the subject.
            The semantic web uses triples of URI's: subject predicate object.
            These triples are also called statements.
            These triples can be stored in different formats. RDF is the most widely supported format.
            The turtle format is much less verbose and therefore easier to read.
            The triples get meanings with ontologies (also expressed in triples)
            though a human can guess a lot without following the mathematical definitions.
            The mother of all ontologies is OWL. An ontology also implies inference. 
            For example: A isAncesterOf B, B isAncestorOf C -> A isAncestorOf C.
            At the moment applying full-fledged inference is slow. Common practice
            is to apply just the rules you actually need.
        </p>
        <p class="justify">
            The conversion performed by the plugin does not comply to an established ontology.
            Cross site queries and inference would be easier when using
            something like FOAF or a similar ontology. 
            The chosen format however was quick and easy to implement
            and is easy to recognise by GedCom tigers.
            It might be wise to monitor for ontologies that might emerge and could
            replace the quick-and-dirty approach.
            A start is made with an ontology to bridge the gap between the unorthodox format and the web.
            The status is not clear but you can find the plain text file
        </p>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="http://arvernes.dyndns.org/fgenj/trunk/AncestrisExtensions/report.rdf/src/genjreports/rdf/GedcomTags.ttl">
            <param name="text" value="<html><u>in the code base</u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object><br/>

        <a name="batches"></a>
        <h3 class="ancestris_help_title">Batches in short</h3>

        <p class="justify">
            The plugin uses the jena library to perform its tasks. 
            Jena has also command line tools that can perform the same tasks and more, 
            except for the conversion from the gedcom to triples.
            Jena is just an example of available tools.
            You can use the command line tools for mashups and/or
            create batches to run multiple queries with a single command.
        </p>

        <h4>More than you want to know:</h4>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="jena.apache.orghttp://jena.apache.org/documentation/query/cmds.html">
            <param name="text" value="<html><u></u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object>

        <h4>The least you want to know:</h4>
        <p class="justify">
            Look for downloads via the link above, get apache-jena and unpack it. 
            Open a command line window and adjust the commands below to your situation:
            each <code>PATH_TO</code> and possibly adjust the jena version to the one you downloaded.
            Note that the variable JENAROOT is not just to provide shorthands,
            but is required by the other commands.
            Creation and using the file <code>merged.n3</code> is optional,
            it is intended for data downloaded from the web. 
            The option <code>--help</code> explains more about the commands.
        </p>
        <p>Windows</p>
        <pre>
        set JENAROOT=C:\PATH_TO\apache-jena-2.7.3
        %JENAROOT%\bat\rdfcat.bat -out N3 c:\PATH_TO_DOWNLOADS\*.rdf > merged.n3
        %JENAROOT%\bat\arq.bat --graph merged.n3 --graph gedcom.ttl --query mashup.arq > result.txt
        </pre>
        <p>Mac / Unix</p>
        <pre>
        set JENAROOT=/PATH_TO/apache-jena-2.7.3
        $JENAROOT/bin/rdfcat -out N3 /PATH_TO_DOWNLOADS/*.rdf > merged.n3
        $JENAROOT/bin/arq --graph merged.n3 --graph gedcom.ttl --query mashup.arq > result.txt
        </pre>

        <a name="mashup"></a>
        <h3 class="ancestris_help_title">Mash up in short</h3>

        <a name="rdf-data"></a>
        <p class="justify">
            The GUI lets you query just a single family tree. 
            The used techniques however allow to 
            cross-query multiple family trees and/or data from the web.
            DbPedia could be an interesting almanac, 
            for example to find famous contemporary local people.
            GeoNames is interesting for maps.
        </p>
        <p class="justify">You may find more interesting resources via the</p>
        <object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
            <param name="content" value="http://richard.cyganiak.de/2007/10/lod/">
            <param name="text" value="<html><u>LOD cloud diagram</u></html>">
            <param name="textFontSize" value="medium">
            <param name="textColor" value="blue">
        </object>
        <p class="justify">
            The rdfcat command shown above allows to collect any data you want. 
            The procedure below is a semi-automated method to collect related data 
            from GeoNames and DbPedia.
        </p>
        <p class="justify">
            Required files:
        </p>
        <ul>
            <li><p class="justify">
                A family database in gedcom format.
                </p>
            </li>
            <li><p class="justify">
                A local copy of <a href="./mashup/mashup.arq">mashup.arq</a>
                </p>
            </li>
            <li><p class="justify">
                Rules: an empty file or a local copy from the 
                <a href="rdf-examples.html">examples</a> that is
                required for other quries you fancy.
                </p>
            </li>
            <li><p class="justify">
                A local variant of <a href="./mashup/mashup.bat">mashup.bat</a> (Windows) 
                or <a href="./mashup/mashup.sh">mashup.sh</a> (Linux/Unix/Mac).
                Adjust the value of the variables JENAROOT and MODS
                according to the configuration of your system.
                Also adjust the last two arguments of the last line.
                </p><p class="justify">
                The example value for the variable MODS is for a beta release of Ancestris.
                For an official release replace "trunk" with the release number, for example "0.8",
                Other components of the paths may vary depending on the configuration
                of your operating system. The optional fourth argument for the final command specifies 
                additional languages for dbpedia resources. For example "fr" or "fr|de".
                </p>
            </li>
        </ul>
        <p class="justify">
            Intermediate results:
        </p>
        <ul>
            <li>
                A family database converted to N3, TTL or RDF.
            </li>
            <li>
                A tab separated file with GeoNameId's paired with
                unique values of INDI:*:PLAC and/or FAM:*:PLAC.
                An example with most places for the Kennedy tree:
                <a href="./mashup/kennedyMashupInput.txt">mashupInput.txt</a>
            </li>
        </ul>
        <p class="justify">
            Result:
        </p>
        <ul>
            <li>
                A <code>merged.n3</code> file for the arq command above.
            </li>
        </ul>
        <p class="justify">
            Steps to take:
        </p>
        <ul>
            <li><p class="justify">
                Convert the gedom and get the places with the mashup query using the GUI:
                <a href="./images/initMashup.jpg">screenshot</a>.
            </p></li>
            <li><p class="justify">
                Read the query results with a spreadsheet program:
                Read with "|" as separator
                (<a href="./images/barAsSeparator.jpg">screenshot</a>),
                save with tabs as separator
                (<a href="./images/saveAsTextWithTabs.jpg">screenshot</a>).
                Delete the header rows and all quotes.
            </p></li>
            <li><p class="justify">
                Put GeoNameIDs in the first column.
                Keep the places in the second column,
                together with all their jurisdictions and separators between them.
                Search the places on www.geonames.org with the show-on-map button
                The balloons with details shows a GeoNameId:
                <a href="./images/FindGeoNamesID.jpg">screenshot</a>.
            </p></li>
            <li><p class="justify">
                Run your version of the mashup.bat or mashup.sh, it takes two arguments:
                mashupInput.txt mashupOutput.n3.
                </p><p class="justify">
                Now you are ready to run any mashup query with the <code>arq</code> command
                (shown under <a href="batches">batches</a>) with both graph files.
                However, the free services of GeoNames and DbPedia are not allways reliable.
                The mashup command is designed not to download again what is already present
                and the logging ends with an overview what this run has downloaded.
                Repeat with significant intervals, until the overview reduces
                to a small list of apparent failures: possibly dead links.
                </p><p class="justify">
                An inital run with the Kennedy example took some 8 minutes
                resulting into some 35MB of data (inluding German and French resources).
                </p>
            </li>
        </ul>
        <a name="FAQ"></a>
        <h3 class="ancestris_help_title">FAQ</h3>

        <dl>
            <dt>The <code>arq</code> command complains about prefixes.</dt>
            <dd><p>This might have one of the following causes:</p>
                <p>a) Remove the warnings
                   in your variant of <code>merged.n3</code>
                </p><p>
                   b) The mashup example contains explicit namespace prefixes.
                   The other <a href="rdf-examples.html">examples</a> don't, the plugin fills in the prefixes.
                   So copy the required prefixes of the mashup query into the other queries 
                   if you want to use them with the command line.
                </p>
            </dd>
            <dt>The <code>arq</code> command complains about Triples not terminated by DOT</dt>
            <dd><p class="justify">
                   The format N3 and TTL may reduce the predicates
                   <code>rdf:type</code> and <code>owl:sameAs</code> to
                   "a" respectively "=". 
                   It looks like <code>arq</code> does not (yet?) support the latter. 
                   So replace the predicate "=" by "owl:sameAs"
                   in the file <code>merged.n3</code>
                </p>
            </dd>
            <dt>The XML produced by the plugin looks like a nice table
               (at least in an IE tab of Firefox), the batch produces plain xml.
            </dt>
            <dd><p class="justify">
                   The plugin inserts an XSLT reference into the xml. 
                   Browsers may apply that transformation into HTML.
                   You may choose to do XSLT processing with JavaScript or 
                   insert on XSLT reference manually, add as second line:
                </p>
               <pre>&lt;?xml-stylesheet type="text/xsl" href="http://www.w3.org/TR/rdf-sparql-XMLres/result-to-html.xsl"?&gt;</pre>
                <p class="justify">
                   NOTE that most browsers don't like cross-site scripting,
                   so save the XSL file in the same domain as your query result.
                </p>
            </dd>
            <dt>What properties are commonly available?</dt>
            <dd>Try the mashup queries:
                <ul>   <li><a href="./mashup/geonamesProperties.arq">geonamesProperties.arq</a>
                  </li><li><a href="./mashup/geonamesRelatedEntities.arq">geonamesRelatedEntities.arq</a>
                  </li><li><a href="./mashup/dbpediaRelatedEntities.arq">dbpediaRelatedEntities.arq</a>
                  </li><li><a href="./mashup/dbpediaProperties.arq">dbpediaProperties.arq</a>
                  </li>
                </ul>
            </dd>
            <dt>Does dbpedia have resources in my language?</dt>
            <dd><p>Try the mashup query <a href="./mashup/geonamesProperties.arq">dbpediaLanguages.arq</a></p></dd>
            <dt>...</dt>
            <dd><p>...</p></dd>
        </dl>
        <br>
        <br>
        <br>
        <br>
        <a href="rdf-todo.html#_Top_">Top</a>
        <br>
        <br>
    </body>
</html>
<!--
Tip: to create a link which will open in an external web browser, outside a paragraph:
<object classid="java:org.netbeans.modules.javahelp.BrowserDisplayer">
    <param name="content" value="http://www.netbeans.org/">
    <param name="text" value="<html><u>http://www.netbeans.org/</u></html>">
    <param name="textFontSize" value="medium">
    <param name="textColor" value="blue">
</object>
To create a link to a help set from another module, you need to know the code name base and path, e.g.:
<a href="nbdocs://org.netbeans.modules.usersguide/org/netbeans/modules/usersguide/configure/configure_options.html">Using the Options Window</a>
(This link will behave sanely if that module is disabled or missing.)
-->